<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/ws22_ulg_ds_julia/libs/highlight/github.min.css">
   
    <script src="/ws22_ulg_ds_julia/libs/clipboard.min.js"></script>
  
  
  <script src="/ws22_ulg_ds_julia/libs/plotly-1_58_5.min.js"></script> 
  <script>
    // This function is used when calling `\fig{...}` See # Using \fig{...} below
    const PlotlyJS_json = async (div, url) => {
      response = await fetch(url); // get file
      fig = await response.json(); // convert it to json
      // Make the plot fit the screen responsively. See the documentation of plotly.js. https://plotly.com/javascript/responsive-fluid-layout/
      if (typeof fig.config === 'undefined') { fig["config"]={} }
      delete fig.layout.width
      delete fig.layout.height
      fig["layout"]["autosize"] = true
      fig["config"]["autosizable"] = true
      fig["config"]["responsive"] = true

      // make it easier to scroll throught the website rather than being blocked by a figure.
      fig.config["scrollZoom"] = false

      // PlotlyJS.savefig by default add the some more attribute to make a static plot.
      // Disable them to make the website fancier.
      delete fig.config.staticPlot
      delete fig.config.displayModeBar
      delete fig.config.doubleClick
      delete fig.config.showTips

      Plotly.newPlot(div, fig);
    };
  </script>
  
  <link rel="stylesheet" href="/ws22_ulg_ds_julia/css/jtd.css">
<link rel="stylesheet" href="/ws22_ulg_ds_julia/css/extras.css">
<link rel="icon" href="/ws22_ulg_ds_julia/assets/favicon.ico">

<style>
  /* #148 wrap long header */
  .franklin-content a.header-anchor,
  .franklin-toc li a
   {
    word-wrap: break-word;
    white-space: normal;
  }
</style>

   <title>Saving Dataframes and Tables.jl</title>  
</head>
<body>                      <!-- closed in foot.html -->
<div class="page-wrap">   <!-- closed in foot.html -->
  <!-- SIDE BAR -->
  <div class="side-bar">
    <div class="header">
      <a href="/ws22_ulg_ds_julia/" class="title">
        Julia
      </a>
    </div>
    <label for="show-menu" class="show-menu">MENU</label>
    <input type="checkbox" id="show-menu" role="button">
    <div class="menu" id="side-menu">
      <ul class="menu-list">
        <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/" class="menu-list-link ">Start</a>
        <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/" class="menu-list-link ">Introduction</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/basis_datatypes_and_operations/" class="menu-list-link ">Basic Data Types and Operations</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/matrix_vectors/" class="menu-list-link ">Matrix and Vector Operations</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/conditional_evaluations/" class="menu-list-link ">Conditional evaluations</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/loops/" class="menu-list-link ">Loops</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/functions/" class="menu-list-link ">Functions</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/metaprogramming/" class="menu-list-link ">Metaprogramming</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/performance/" class="menu-list-link ">Performance</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/package_manager/" class="menu-list-link ">Package manager</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/development_workflow/" class="menu-list-link ">Development workflow</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/useful_packages/"
                    class="menu-list-link ">Useful
                    packages</a>
          </ul>
        <li class="menu-list-item active"><a href="/ws22_ulg_ds_julia/pages/data_management/" class="menu-list-link active">Data Management</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/loading_data/" class="menu-list-link ">Loading data</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/saving_data/" class="menu-list-link active">Saving data</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/exploratory_da/" class="menu-list-link ">Exploratory Data Analysis</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/datasets/" class="menu-list-link ">Data Sets</a>
          </ul>
          <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/neural_networks/" class="menu-list-link ">Neural Networks</a>
            <ul class="menu-list-child-list ">
              <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/neural_networks/exercise/" class="menu-list-link ">Exercise</a>
            </ul>
          <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/reporting/" class="menu-list-link ">Reporting</a>
      </ul>
    </div>
    <div class="footer">
      This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target="_blank">Jekyll theme</a>.
    </div>
  </div>
  <!-- CONTENT -->
  <div class="main-content-wrap"> <!-- closed in foot.html -->
    <div class="main-content">    <!-- closed in foot.html -->
      <div class="main-header">
        WS22/23 ULG Data Science
      </div>



<!-- Content appended here (in class franklin-content) -->
<div class="franklin-content"><h1 id="saving_dataframes"><a href="#saving_dataframes" class="header-anchor">Saving dataframes</a></h1>
<p>Now that we prepared our data source and noticed how much work it was to restore the original data types, it make sense to save the current state of our dataframe. Our data source was provided in the CSV format which has the major disadvantage that Julia needs to elaborately guess the data type of each column, the used decimal symbol, and so on. But it is also possible to store this so-called meta data along with the dataframe. <a href="https://arrow.juliadata.org/stable/"><code>Arrow.jl</code></a> provides sufficient metadata to know how each item has to be interpreted &#40;at least for simple types&#41;. Additionally, this format is compatible across different computer architectures and can be read with various programming languages &#40;like e.g. Julia, Python and R&#41;.</p>
<p>To write a dataframe into an arrow-file simply call:</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> Arrow

Arrow.write(<span class="hljs-string">&quot;survey.arrow&quot;</span>, df_survey)</code></pre>
<p>We can also pass additional options such as <code>compress &#61; :zstd</code> for compressing the data. Loading the file again is slightly more complicated since <code>Arrow.Table</code> is immutable by default and not fully loaded into memory. Thus we need to <code>copy</code> each column in order to convert the Arrow data into normal <code>Vector</code>s.</p>
<pre><code class="julia hljs"><span class="hljs-keyword">using</span> Arrow, DataFrames

df_survey = DataFrame(Arrow.Table(<span class="hljs-string">&quot;survey.arrow&quot;</span>); copycols=<span class="hljs-literal">true</span>)</code></pre>
<h1 id="tablesjl"><a href="#tablesjl" class="header-anchor">Tables.jl</a></h1>
<p>Columnar data also called tables is quite a general concept seen in databases, CSV files, Excel files, <code>Dataframes</code> and in many more instances. It would be possible to always use <code>DataFrames</code> in order for Julia to interact with these. However, <code>DataFrames</code> are quite special since they make certain assumptions on the table e.g. that each element can be accessed and changed independently. But we have already seen above that for <code>Arrow.Table</code> this is not the case.</p>
<p>So packages which operate on tabular data e.g. <a href="https://juliadatabases.org/SQLite.jl/stable/">SQLite.jl</a> and <a href="https://csv.juliadata.org/stable/">CSV.jl</a>  do not use <code>Dataframes</code> but the small interface package <a href="https://tables.juliadata.org/stable/">Tables.jl</a> which defines a common set of functions that should work on all tabular data types. Thus <a href="https://github.com/JuliaData/Tables.jl/blob/master/INTEGRATIONS.md">each package</a> implementing the table interface can work with a <code>DataFrame</code> or other tabular types. For example</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> <span class="hljs-keyword">using</span> Arrow, Tables, DataFrames
</span>
<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> table = (x = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], y = [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-literal">missing</span>, <span class="hljs-string">&quot;b&quot;</span>], z = rand(<span class="hljs-number">3</span>));
</span>
<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> Tables.istable(table)
</span>true

<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> Tables.schema(table)
</span>Tables.Schema:
 :x  Int64
 :y  Union{Missing, String}
 :z  Float64

<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> Arrow.write(<span class="hljs-string">&quot;test.arrow&quot;</span>, table)
</span>&quot;test.arrow&quot;

<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> df = DataFrame(Arrow.Table(<span class="hljs-string">&quot;test.arrow&quot;</span>); copycols=<span class="hljs-literal">true</span>)
</span>3×3 DataFrame
 Row │ x      y        z         
     │ Int64  String?  Float64   
─────┼───────────────────────────
   1 │     1  a        0.457727
   2 │     2  missing  0.0677743
   3 │     3  b        0.529353

<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> Tables.istable(df)
</span>true

<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> Tables.materializer(df)
</span>DataFrame

<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> Tables.materializer(table)
</span>columntable (generic function with 5 methods)

<span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> Tables.materializer(table)(df)
</span>(x = [1, 2, 3], y = Union{Missing, String}[&quot;a&quot;, missing, &quot;b&quot;], z = [0.45772704497893035, 0.06777425699530504, 0.5293528119836353])</code></pre>
<p>Let us go into more details on each concept that we see her:</p>
<ul>
<li><p>any <code>NamedTuple</code> of vectors is a table</p>
</li>
<li><p><code>Arrow.write</code> accept and can save any table</p>
</li>
<li><p><code>Tables.materializer</code> returns the initialization/construction functions of the input table</p>
</li>
<li><p>the materializer for dataframes is simply <code>DataFrame</code></p>
</li>
</ul>
<p>The last point is important since it means that any <code>Tables.jl</code> compatible type can be converted into a <code>DataFrame</code> by using <code>DataFrame&#40;...; copycols&#61;true&#41;</code> and then work with it as expected.</p>
<div class="page-foot">
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> - <a href="https://www.uibk.ac.at/mathematik/personal/antholzer/">Stephan Antholzer</a>, <a href="https://ehrensperger.dev/">Gregor Ehrensperger</a>, <a href="https://igs.uibk.ac.at/igs_html/members/IGSMember_Sappl.html">Johannes Sappl</a>. Last modified: January 31, 2023.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    </div> <!-- end of class main-content -->
    </div> <!-- end of class main-content-wrap -->
    </div> <!-- end of class page-wrap-->
    
    
      


      <script>
    (function(){
    
      // Get the elements.
      // - the 'pre' element.
      // - the 'div' with the 'paste-content' id.
    
      var pre = document.getElementsByTagName('pre');
    
      // Add a copy button in the 'pre' element.
      // which only has the className of 'language-'.
    
      for (var i = 0; i < pre.length; i++) {
        var isLanguage = pre[i].children[0].tagName == 'CODE';
    
        if ( isLanguage ) {
          var button           = document.createElement('button');
              button.className = 'copy-button';
              button.textContent = 'Copy';
    
              pre[i].appendChild(button);
        }
      };
    
      // Run Clipboard
    
      var copyCode = new Clipboard('.copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
    
      // On success:
      // - Change the "Copy" text to "Copied".
      // - Swap it to "Copy" in 2s.
      // - Lead user to the "contenteditable" area with Velocity scroll.
    
      copyCode.on('success', function(event) {
        event.clearSelection();
        event.trigger.textContent = 'Copied';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 2000);
    
      });
    
      // On error (Safari):
      // - Change the  "Press Ctrl+C to copy"
      // - Swap it to "Copy" in 2s.
    
      copyCode.on('error', function(event) {
        event.trigger.textContent = 'Press "Ctrl + C" to copy';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 5000);
      });
    
    })();
</script>
    
  </body>
</html>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }
</script>

<script>
  var coll = document.getElementsByClassName("solutioncollapsible");
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const myVar = urlParams.get('solution')
  if ( myVar == 'true') {
    for (i = 0; i < coll.length; i++) {
      coll[i].style.display = "block";
    }
  }
</script>
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/ws22_ulg_ds_julia/libs/highlight/github.min.css">
   
    <script src="/ws22_ulg_ds_julia/libs/clipboard.min.js"></script>
  
  
  <script src="/ws22_ulg_ds_julia/libs/plotly-1_58_5.min.js"></script> 
  <script>
    // This function is used when calling `\fig{...}` See # Using \fig{...} below
    const PlotlyJS_json = async (div, url) => {
      response = await fetch(url); // get file
      fig = await response.json(); // convert it to json
      // Make the plot fit the screen responsively. See the documentation of plotly.js. https://plotly.com/javascript/responsive-fluid-layout/
      if (typeof fig.config === 'undefined') { fig["config"]={} }
      delete fig.layout.width
      delete fig.layout.height
      fig["layout"]["autosize"] = true
      fig["config"]["autosizable"] = true
      fig["config"]["responsive"] = true

      // make it easier to scroll throught the website rather than being blocked by a figure.
      fig.config["scrollZoom"] = false

      // PlotlyJS.savefig by default add the some more attribute to make a static plot.
      // Disable them to make the website fancier.
      delete fig.config.staticPlot
      delete fig.config.displayModeBar
      delete fig.config.doubleClick
      delete fig.config.showTips

      Plotly.newPlot(div, fig);
    };
  </script>
  
  <link rel="stylesheet" href="/ws22_ulg_ds_julia/css/jtd.css">
<link rel="stylesheet" href="/ws22_ulg_ds_julia/css/extras.css">
<link rel="icon" href="/ws22_ulg_ds_julia/assets/favicon.ico">

<style>
  /* #148 wrap long header */
  .franklin-content a.header-anchor,
  .franklin-toc li a
   {
    word-wrap: break-word;
    white-space: normal;
  }
</style>

   <title>Introduction - Metaprogramming</title>  
</head>
<body>                      <!-- closed in foot.html -->
<div class="page-wrap">   <!-- closed in foot.html -->
  <!-- SIDE BAR -->
  <div class="side-bar">
    <div class="header">
      <a href="/ws22_ulg_ds_julia/" class="title">
        Julia
      </a>
    </div>
    <label for="show-menu" class="show-menu">MENU</label>
    <input type="checkbox" id="show-menu" role="button">
    <div class="menu" id="side-menu">
      <ul class="menu-list">
        <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/" class="menu-list-link ">Start</a>
        <li class="menu-list-item active"><a href="/ws22_ulg_ds_julia/pages/introduction/" class="menu-list-link active">Introduction</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/basis_datatypes_and_operations/" class="menu-list-link ">Basic Data Types and Operations</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/matrix_vectors/" class="menu-list-link ">Matrix and Vector Operations</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/conditional_evaluations/" class="menu-list-link ">Conditional evaluations</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/loops/" class="menu-list-link ">Loops</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/functions/" class="menu-list-link ">Functions</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/metaprogramming/" class="menu-list-link active">Metaprogramming</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/performance/" class="menu-list-link ">Performance</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/package_manager/" class="menu-list-link ">Package manager</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/development_workflow/" class="menu-list-link ">Development workflow</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/introduction/useful_packages/"
                    class="menu-list-link ">Useful
                    packages</a>
          </ul>
        <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/" class="menu-list-link ">Data Management</a>
          <ul class="menu-list-child-list ">
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/loading_data/" class="menu-list-link ">Loading data</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/saving_data/" class="menu-list-link ">Saving data</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/exploratory_da/" class="menu-list-link ">Exploratory Data Analysis</a>
            <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/data_management/datasets/" class="menu-list-link ">Data Sets</a>
          </ul>
          <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/neural_networks/" class="menu-list-link ">Neural Networks</a>
            <ul class="menu-list-child-list ">
              <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/neural_networks/exercise/" class="menu-list-link ">Exercise</a>
            </ul>
          <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/reporting/" class="menu-list-link ">Reporting</a>
            <ul class="menu-list-child-list ">
                <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/reporting/latex/" class="menu-list-link ">LaTeX</a>
                <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/reporting/markdown/" class="menu-list-link ">Markdown</a>
                <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/reporting/jupyter/" class="menu-list-link ">Jupyter</a>
                <li class="menu-list-item "><a href="/ws22_ulg_ds_julia/pages/reporting/pluto/" class="menu-list-link ">Pluto.jl</a>
            </ul>
      </ul>
    </div>
    <div class="footer">
      This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target="_blank">Jekyll theme</a>.
    </div>
  </div>
  <!-- CONTENT -->
  <div class="main-content-wrap"> <!-- closed in foot.html -->
    <div class="main-content">    <!-- closed in foot.html -->
      <div class="main-header">
        WS22/23 ULG Data Science
      </div>



<!-- Content appended here (in class franklin-content) -->
<div class="franklin-content"><h1 id="metaprogramming"><a href="#metaprogramming" class="header-anchor">Metaprogramming</a></h1>
<p><a href="https://docs.julialang.org/en/v1/manual/metaprogramming">Metaprogramming</a> is a very powerful concept. Since Julia code itself is represented in the language via its own datastructure &#40;an <code>Expr</code>ession&#41; a Julia program can freely manipulate and generate its own code. However, in this section we only give a short overview of metaprogramming concepts because it is an advanced feature of the language. When we run Julia code roughly the following steps are performed to get from text to native code:</p>
<ol>
<li><p>Parsing &#40;<code>Meta.parse</code>&#41;</p>
</li>
<li><p>Lowering and type inference &#40;<code>@code_warntype</code>&#41;</p>
</li>
<li><p>Compile to LLVM intermediate representation &#40;<code>@code_llvm</code>&#41;</p>
</li>
<li><p>Compile to native code using LLVM &#40;<code>@code_native</code>&#41;</p>
</li>
</ol>
<p>The function/macros in parentheses allow us to further investigate each step by letting us take a look at the output interactively. In step 1 the code is read and transformed into <code>Expr</code>essions. Then the compiler tries to find the concrete type of each expression i.e. each variable and each return type. If type inference fails, it is highlighted in the <code>@code_warntype</code> output. This can be useful since it sometimes leads to performance problems. The final two steps are not really important for us since their output is already quite low level and difficult to read and understand. But one can use <code>@code_llvm</code> to debug performance problems or for optimization. Metaprogramming is usually performed between steps 1 and 2. A common use case are macros.</p>
<p>In principle a macro is similar to a function as it maps a tuple of arguments to an expression that is then returned. Therefore, Julia reserves the <code>@</code> symbol as the first character for macro definitions in order to distinguish them from functions in the code. Apart from that what differentiates macros from functions most is that macros</p>
<ol>
<li><p>are compiled directly and not at first call,</p>
</li>
<li><p>are executed when the code is parsed.</p>
</li>
</ol>
<p>The second feature is the important one as it lets us manipulate code at runtime. Another convenient thing about macros is their ability to insert quite powerful code while also keeping the readability high. We have already seen multiple macros, e.g., <code>@time</code> which basically just inserts <code>Base.time_ns&#40;&#41;</code> before and after the expression passed to the macro and returns the difference. Keep in mind that the actual definition is more complex.</p>
<pre><code class="julia-repl hljs"><span class="hljs-meta prompt_">julia&gt;</span><span class="language-julia"> <span class="hljs-meta">@time</span> sleep(<span class="hljs-number">1</span>)
</span>  1.002452 seconds (5 allocations: 144 bytes)</code></pre>
<p>In contrast to functions it is possible to time arbitrary Julia code with the <code>@time</code> macro. Defining a useful macro can be difficult and also quite different from ordinary Julia code because all operations have to be performed on <code>Expr</code>. Thus, we will not discuss it here. However, have a look at the documentation of all the macros we have been using so far as well as these ones: <code>@view</code>, <code>@views</code>, <code>@.</code>, <code>@assert</code>, <code>@info</code>, <code>@warn</code>, <code>@error</code> and <code>@__DIR__</code>.</p>
<p>Another useful example for metaprogramming is the definition of multiple functions using a <code>for</code> loop. In the following example from the <a href="https://docs.julialang.org/en/v1/manual/metaprogramming/#Code-Generation">Julia manual</a> we have defined a custom number type. We would also like to define methods of common built-in functions for this type. We could do it manually but metaprogramming makes it shorter, easier to read, and easier to extend.</p>
<pre><code class="julia hljs"><span class="hljs-keyword">struct</span> MyNumber
    x::<span class="hljs-built_in">Float64</span>
<span class="hljs-keyword">end</span>

<span class="hljs-keyword">for</span> op <span class="hljs-keyword">in</span> (:sin, :cos, :tan, :log, :exp)
    <span class="hljs-meta">@eval</span> Base.$op(a::MyNumber) = MyNumber($op(a.x))
<span class="hljs-keyword">end</span></code></pre>
<p>The main ingredient is the <code>@eval</code> macro which creates an expression and then evaluates it. This is equivalent to <code>eval&#40;:&#40;Base.&#36;op&#40;a::MyNumber&#41; &#61; MyNumber&#40;&#36;op&#40;a.x&#41;&#41;&#41;&#41;</code>. The above method can also be used for more complex function definitions and not just one-liners.</p>
<div class="page-foot">
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> - <a href="https://www.uibk.ac.at/mathematik/personal/antholzer/">Stephan Antholzer</a>, <a href="https://ehrensperger.dev/">Gregor Ehrensperger</a>, <a href="https://igs.uibk.ac.at/igs_html/members/IGSMember_Sappl.html">Johannes Sappl</a>. Last modified: August 31, 2023.
    Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
</div>
</div><!-- CONTENT ENDS HERE -->
    </div> <!-- end of class main-content -->
    </div> <!-- end of class main-content-wrap -->
    </div> <!-- end of class page-wrap-->
    
    
      


      <script>
    (function(){
    
      // Get the elements.
      // - the 'pre' element.
      // - the 'div' with the 'paste-content' id.
    
      var pre = document.getElementsByTagName('pre');
    
      // Add a copy button in the 'pre' element.
      // which only has the className of 'language-'.
    
      for (var i = 0; i < pre.length; i++) {
        var isLanguage = pre[i].children[0].tagName == 'CODE';
    
        if ( isLanguage ) {
          var button           = document.createElement('button');
              button.className = 'copy-button';
              button.textContent = 'Copy';
    
              pre[i].appendChild(button);
        }
      };
    
      // Run Clipboard
    
      var copyCode = new Clipboard('.copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
    
      // On success:
      // - Change the "Copy" text to "Copied".
      // - Swap it to "Copy" in 2s.
      // - Lead user to the "contenteditable" area with Velocity scroll.
    
      copyCode.on('success', function(event) {
        event.clearSelection();
        event.trigger.textContent = 'Copied';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 2000);
    
      });
    
      // On error (Safari):
      // - Change the  "Press Ctrl+C to copy"
      // - Swap it to "Copy" in 2s.
    
      copyCode.on('error', function(event) {
        event.trigger.textContent = 'Press "Ctrl + C" to copy';
        window.setTimeout(function() {
          event.trigger.textContent = 'Copy';
        }, 5000);
      });
    
    })();
</script>
    
  </body>
</html>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }
</script>

<script>
  var coll = document.getElementsByClassName("solutioncollapsible");
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const myVar = urlParams.get('solution')
  if ( myVar == 'true') {
    for (i = 0; i < coll.length; i++) {
      coll[i].style.display = "block";
    }
  }
</script>